Title: How to include Mojolicious in your app's git repository
Tags: Perl, Mojolicious, git

=pod

When you are developing an application that you want to deploy really fast and
easy you should consider including L<Mojolicious> files in your repository.

Some of the advantadges of this approach are:

=over

=item * You don't have to worry about installing Mojolicious

=item * You don't have to worry about non compatible Mojolicious version installed on the production server

=item * You always have a Mojolicious version that works with your application

=item * Creating a tarball that constains everything can be done by git

=back

One of the disadvantages is that it is not easy to setup, but this post is going
to fix that.

[cut]

There are two major ways to include other projects in your git repository:
C<submodules> and C<subtrees>. We start with the easiest but not the best.

=head2 Submodules

So you have your application under git. For example project's tree looks like
this:

    $ ls
    lib/       log/       public/    script/    t/         templates/

Let's create a C<contrib> directory where we will put all 3rd party modules (in
the simplest case only L<Mojolicious>):

    $ mkdir contrib
    $ ls
    contrib/   lib/       log/       public/    script/    t/         templates/

Now we add a C<submodule> that will containt L<Mojolicious> repository.

    $ git submodule add http://github.com/kraih/mojo.git contrib/mojo
    Cloning into contrib/mojo...
    ...
    $ ls contrib/mojo
    Changes        LICENSE        MANIFEST.SKIP  Makefile.PL    README.pod
    examples/      lib/           script/        t/

So now we have a separate directory that holds all L<Mojolicous> files. But the
next time your repository is cloned you will have to update submodules too.

    $ git submodule update --init

When updating submodules a normal C<git pull> can be used. In case if you have
many submodules you can update them within one command:

    $ git submodule foreach 'git pull'

=head2 Subtrees

In the case of a subtree we inject L<Mojolicious> repository as a subdirectory
that doesn't look any different from other files in your repository.

First we add a remote branch:

    $ git remote add -f mojo http://github.com/kraih/mojo.git
    Updating mojo
    ...
    $ git branch -r
      mojo/master

Then we want to pull L<Mojolicious> as a subdirectory to the project:

    $ git read-tree --prefix=contrib/mojo/ -u mojo/master

Now commit to add the files:

    $ git commit -m 'Added Mojolicious as a subtree'

Every time when you want to update C<contrib/mojo> directory run this command:

    $ git merge --squash -s subtree --no-commit mojo/master
    ...
    Squash commit -- not updating HEAD
    Automatic merge went well; stopped before committing as requested

So we import all the changes as one patch and we don't do automatic commit. You
can commit now:

    $ git commit -m 'Updated Mojolicious'

In the case of subtree you don't have to do anything except cloning.
L<Mojolicious> files will just be there.

=head2 SEE ALSO

More on C<submodules> L<http://book.git-scm.com/5_submodules.html>

More on C<subtrees> L<http://progit.org/book/ch6-7.html>
